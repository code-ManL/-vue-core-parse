{"code":"import { isObject } from '@vue/shared';\r\nimport { track, trigger } from './effect';\r\nconst mutableHandlers = {\r\n    get(target, key, recevier) {\r\n        // 如果target已经被代理过了就直接返回true\r\n        if (key === \"__v_isReactive\" /* ReactiveFlags.IS_REACTIVE */) {\r\n            return true;\r\n        }\r\n        // 触发getter收集副作用函数effect\r\n        track(target, key);\r\n        return Reflect.get(target, key, recevier);\r\n    },\r\n    set(target, key, value, recevier) {\r\n        // 需要先设置值，再去追踪，重新执行副作用函数\r\n        const res = Reflect.set(target, key, value, recevier);\r\n        trigger(target, key);\r\n        return res;\r\n    }\r\n};\r\nconst reactiveMap = new WeakMap(); // 缓存代理过的target\r\n// 工厂函数\r\nexport function createReactiveObject(target) {\r\n    // 判断传入的数据是否为对象\r\n    if (!isObject(target)) {\r\n        // __DEV__用于判断当前的代码编写环境为开发环境的时候，发出警告，因此在生产环境下这段代码为dead code，利用tree-shaking(依赖于ES Module)移除掉\r\n        if ('__DEV__') {\r\n            console.warn(`value cannot be made reactive: ${String(target)}`);\r\n        }\r\n        return target;\r\n    }\r\n    // 判断target是否被代理过，如果target是一个响应式对象，这里会触发getter(主要针对于target是一个响应式对象，如果target是原始对象不会触发getter，只有响应式对象才会触发getter)\r\n    if (target[\"__v_isReactive\" /* ReactiveFlags.IS_REACTIVE */]) {\r\n        return target;\r\n    }\r\n    // 优先通过原始对象 obj 寻找之前创建的代理对象，如果找到了，直接返回已有的代理对象，简单的说就是代理过的对象不再重复代理，取出之前创建的代理对象返回\r\n    const existionProxy = reactiveMap.get(target);\r\n    if (existionProxy)\r\n        return existionProxy;\r\n    const proxy = new Proxy(target, mutableHandlers); // 数据劫持\r\n    reactiveMap.set(target, proxy); // 缓存\r\n    return proxy; // 返回代理\r\n}\r\nexport function reactive(target) {\r\n    return createReactiveObject(target);\r\n}\r\nexport function readonly(target) {\r\n}\r\nexport function shallowReactive(target) {\r\n}\r\nexport function shallowReadOnly(target) {\r\n}\r\n//# sourceMappingURL=reactive.js.map","references":["F:/forTest/monorope2/packages/shared/src/index.ts","F:/forTest/monorope2/packages/reactivity/src/effect.ts"],"map":"{\"version\":3,\"file\":\"reactive.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../packages/reactivity/src/reactive.ts\"],\"names\":[],\"mappings\":\"AAAA,OAAO,EAAE,QAAQ,EAAE,MAAM,aAAa,CAAA;AAEtC,OAAO,EAAE,KAAK,EAAE,OAAO,EAAE,MAAM,UAAU,CAAA;AAIzC,MAAM,eAAe,GAAmC;IACtD,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,QAAQ;QACvB,2BAA2B;QAC3B,IAAI,GAAG,qDAA8B,EAAE;YACrC,OAAO,IAAI,CAAA;SACZ;QACD,wBAAwB;QACxB,KAAK,CAAC,MAAM,EAAE,GAAG,CAAC,CAAA;QAIlB,OAAO,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,QAAQ,CAAC,CAAA;IAE3C,CAAC;IACD,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,KAAK,EAAE,QAAQ;QAE9B,wBAAwB;QACxB,MAAM,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,KAAK,EAAE,QAAQ,CAAC,CAAA;QACrD,OAAO,CAAC,MAAM,EAAE,GAAG,CAAC,CAAA;QAEpB,OAAO,GAAG,CAAA;IACZ,CAAC;CACF,CAAA;AAED,MAAM,WAAW,GAAG,IAAI,OAAO,EAAe,CAAC,CAAC,eAAe;AAE/D,OAAO;AACP,MAAM,UAAU,oBAAoB,CAAC,MAAc;IAEjD,eAAe;IACf,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE;QACrB,2FAA2F;QAC3F,IAAI,SAAS,EAAE;YACb,OAAO,CAAC,IAAI,CAAC,kCAAkC,MAAM,CAAC,MAAM,CAAC,EAAE,CAAC,CAAA;SACjE;QACD,OAAO,MAAM,CAAA;KACd;IAED,6GAA6G;IAC7G,IAAI,MAAM,kDAA2B,EAAE;QACrC,OAAO,MAAM,CAAA;KACd;IAED,8EAA8E;IAC9E,MAAM,aAAa,GAAG,WAAW,CAAC,GAAG,CAAC,MAAM,CAAC,CAAA;IAC7C,IAAI,aAAa;QACf,OAAO,aAAa,CAAA;IAEtB,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,MAAM,EAAE,eAAe,CAAC,CAAA,CAAC,OAAO;IAExD,WAAW,CAAC,GAAG,CAAC,MAAM,EAAE,KAAK,CAAC,CAAA,CAAC,KAAK;IAGpC,OAAO,KAAK,CAAA,CAAC,OAAO;AACtB,CAAC;AAID,MAAM,UAAU,QAAQ,CAAC,MAAc;IACrC,OAAO,oBAAoB,CAAC,MAAM,CAAC,CAAA;AACrC,CAAC;AAED,MAAM,UAAU,QAAQ,CAAC,MAAc;AAEvC,CAAC;AAGD,MAAM,UAAU,eAAe,CAAC,MAAc;AAE9C,CAAC;AAED,MAAM,UAAU,eAAe,CAAC,MAAc;AAE9C,CAAC\"}"}
