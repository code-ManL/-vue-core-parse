{"code":"var _a;\r\nimport { isFunction, NOOP } from \"@vue/shared\";\r\nimport { isTracking, ReactiveEffect, trackEffects, triggerEffects } from './effect';\r\nexport class ComputedRefImpl {\r\n    constructor(getter, _setter, isReadonly) {\r\n        this._setter = _setter;\r\n        this.dep = undefined;\r\n        this.__v_isRef = true;\r\n        this._dirty = true; // 默认脏的\r\n        this[_a] = false;\r\n        // 这里将计算属性包成一个effect , getter相当于effect当中的副作用函数\r\n        this.effect = new ReactiveEffect(getter, () => {\r\n            // 稍后计算属性的值发生变化了,不要重新执行getter,而是走第二个函数\r\n            if (!this._dirty) {\r\n                this._dirty = true;\r\n                // 重新执行最外层的effect\r\n                triggerEffects(this.dep);\r\n            }\r\n        });\r\n        this[\"__v_isReadonly\" /* ReactiveFlags.IS_READONLY */] = isReadonly;\r\n    }\r\n    // 取值时, 编译完就是Object.defineProperty\r\n    get value() {\r\n        if (isTracking()) { //是否是在effect中取值的\r\n            trackEffects(this.dep || (this.dep = new Set)); // 将外层的effect收集,相当于收集 computed.value -> Set(effect)\r\n        }\r\n        if (this._dirty) {\r\n            // 缓存结果 \r\n            this._dirty = false;\r\n            this._value = this.effect.run();\r\n        }\r\n        return this._value;\r\n    }\r\n    set value(newValue) {\r\n        this._setter(newValue); // 如果修改计算属性的值就走setter\r\n    }\r\n}\r\n_a = \"__v_isReadonly\" /* ReactiveFlags.IS_READONLY */;\r\nexport function computed(getterOrOptions) {\r\n    // 判断传入的值是函数还是配置对象{get,set}\r\n    const onlyGetter = isFunction(getterOrOptions);\r\n    let getter;\r\n    let setter;\r\n    if (onlyGetter) {\r\n        getter = getterOrOptions;\r\n        setter = false // __DEV__\r\n            ? () => {\r\n                console.warn('Write operation failed: computed value is readonly');\r\n            }\r\n            : NOOP;\r\n    }\r\n    else {\r\n        getter = getterOrOptions.get;\r\n        setter = getterOrOptions.set;\r\n    }\r\n    return new ComputedRefImpl(getter, setter);\r\n}\r\n//# sourceMappingURL=computed.js.map","references":["F:/forTest/monorope2/packages/shared/src/index.ts","F:/forTest/monorope2/packages/reactivity/src/dep.ts","F:/forTest/monorope2/packages/reactivity/src/effect.ts","F:/forTest/monorope2/packages/reactivity/src/reactive.ts"],"map":"{\"version\":3,\"file\":\"computed.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../packages/reactivity/src/computed.ts\"],\"names\":[],\"mappings\":\";AAAA,OAAO,EAAE,UAAU,EAAE,IAAI,EAAE,MAAM,aAAa,CAAA;AAE9C,OAAO,EAAE,UAAU,EAAE,cAAc,EAAE,YAAY,EAAW,cAAc,EAAE,MAAM,UAAU,CAAA;AA6B5F,MAAM,OAAO,eAAe;IAQ1B,YACE,MAAyB,EACR,OAA0B,EAC3C,UAAoB;QADH,YAAO,GAAP,OAAO,CAAmB;QATtC,QAAG,GAAS,SAAS,CAAA;QAGZ,cAAS,GAAG,IAAI,CAAA;QACzB,WAAM,GAAG,IAAI,CAAA,CAAE,OAAO;QACb,QAA2B,GAAY,KAAK,CAAA;QAO1D,8CAA8C;QAC9C,IAAI,CAAC,MAAM,GAAG,IAAI,cAAc,CAAC,MAAM,EAAE,GAAG,EAAE;YAC5C,sCAAsC;YACtC,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;gBAChB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAA;gBAClB,iBAAiB;gBACjB,cAAc,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;aACzB;QACH,CAAC,CAAC,CAAA;QAEF,IAAI,kDAA2B,GAAG,UAAU,CAAA;IAC9C,CAAC;IAED,kCAAkC;IAClC,IAAI,KAAK;QACP,IAAI,UAAU,EAAE,EAAE,EAAE,gBAAgB;YAClC,YAAY,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,GAAG,IAAI,GAAmB,CAAC,CAAC,CAAA,CAAC,mDAAmD;SACnH;QAED,IAAI,IAAI,CAAC,MAAM,EAAE;YACf,QAAQ;YACR,IAAI,CAAC,MAAM,GAAG,KAAK,CAAA;YACnB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,CAAA;SAChC;QACD,OAAO,IAAI,CAAC,MAAM,CAAA;IACpB,CAAC;IAED,IAAI,KAAK,CAAC,QAAW;QACnB,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAA,CAAC,qBAAqB;IAC9C,CAAC;CACF;;AAED,MAAM,UAAU,QAAQ,CAAI,eAA+D;IACzF,2BAA2B;IAC3B,MAAM,UAAU,GAAG,UAAU,CAAC,eAAe,CAAC,CAAA;IAE9C,IAAI,MAAyB,CAAA;IAC7B,IAAI,MAAyB,CAAA;IAE7B,IAAI,UAAU,EAAE;QACd,MAAM,GAAG,eAAe,CAAA;QACxB,MAAM,GAAG,KAAK,CAAC,UAAU;YACvB,CAAC,CAAC,GAAG,EAAE;gBACL,OAAO,CAAC,IAAI,CAAC,oDAAoD,CAAC,CAAA;YACpE,CAAC;YACD,CAAC,CAAC,IAAI,CAAA;KACT;SAAM;QACL,MAAM,GAAG,eAAe,CAAC,GAAG,CAAA;QAC5B,MAAM,GAAG,eAAe,CAAC,GAAG,CAAA;KAC7B;IAED,OAAO,IAAI,eAAe,CAAC,MAAM,EAAE,MAAM,CAAC,CAAA;AAC5C,CAAC\"}"}
